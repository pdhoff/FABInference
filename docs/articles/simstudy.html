<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Demo and simulation study of FAB p-values • FABInference</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Demo and simulation study of FAB p-values">
<meta property="og:description" content="FABInference">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FABInference</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/exampleFHmodel.html">FAB p-values for small areas</a>
    </li>
    <li>
      <a href="../articles/exampleHMM.html">FAB p-values for a hidden Markov model</a>
    </li>
    <li>
      <a href="../articles/exampleInteraction.html">FAB p-values for group-level slopes in ANCOVA models</a>
    </li>
    <li>
      <a href="../articles/exampleLogistic.html">Asymptotically uniform FAB p-values</a>
    </li>
    <li>
      <a href="../articles/simstudy.html">Demo and simulation study of FAB p-values</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="simstudy_files/header-attrs-2.5/header-attrs.js"></script><script src="simstudy_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="simstudy_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="simstudy_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Demo and simulation study of FAB p-values</h1>
                        <h4 class="author">Peter Hoff</h4>
            
            <h4 class="date">2019-07-23</h4>
      
      
      <div class="hidden name"><code>simstudy.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">FABInference</span><span class="op">)</span></code></pre></div>
<p>This vignette presents a small simulation study comparing FAB <span class="math inline">\(p\)</span>-values to UMPU <span class="math inline">\(p\)</span>-values (for linear models) and to Wald <span class="math inline">\(p\)</span>-values (for generalized linear models). There are <span class="math inline">\(2\times 3\)</span> scenarios considered - two “models” (normal linear regression and Poisson regression), and three regimes for the true regression coefficients:</p>
<ol style="list-style-type: decimal">
<li><p>all coefficients are zero;</p></li>
<li><p>coefficients are distributed symmetrically around zero;</p></li>
<li><p>coefficients are somewhat linearly related to an observed explanatory variable.</p></li>
</ol>
<p>What do we expect to happen, and why?</p>
<ol style="list-style-type: decimal">
<li><p>When all coefficients are zero, then the FAB and UMPU <span class="math inline">\(p\)</span>-values fr the linear model are exactly uniformly distributed. For the glm, they will be approximately (asymptotically) uniformly distributed.</p></li>
<li><p>The worst-case scenario for the FAB <span class="math inline">\(p\)</span>-values is the case where the true coefficients are centered around zero, and there is no external information distinguishing the positive from the negative coefficients. This is because there is no information for the adaptive FAB procedure to learn from. However, if the linking model includes a distribution centered around zero, then we expect the FAB procedure to adapt to this, resulting in <span class="math inline">\(p\)</span>-values that closely resemble the UMPU and Wald <span class="math inline">\(p\)</span>-values.</p></li>
<li><p>If there coefficients are not centered around zero or are related to an observed variable, then the adaptive FAB procedure can learn the center or the relationship, and then use more powerful test statistics to improve performance, on average across parameters.</p></li>
</ol>
<p>Below is code to implement these scenarios. Note that for pedagogic reasons<br>
an extra couple of observed “control” variables, <code>w1</code> and <code>w2</code> are included in the regression model, but are not part of the linking model. Below the code is a summary plot of the results, giving the CDFs of the different kinds of <span class="math inline">\(p\)</span>-values. The results are as expected.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#### sim study  </span>
<span class="va">n</span><span class="op">&lt;-</span><span class="fl">100</span> ; <span class="va">p</span><span class="op">&lt;-</span><span class="fl">25</span> ; <span class="va">nsim</span><span class="op">&lt;-</span><span class="fl">100</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfcol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span>,mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,mgp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.75</span>,<span class="fl">.75</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">model</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Gaussian"</span>,<span class="st">"Poisson"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> 
<span class="kw">for</span><span class="op">(</span><span class="va">scenario</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">{</span> 

  <span class="va">FP</span><span class="op">&lt;-</span><span class="cn">NULL</span> ; <span class="va">UP</span><span class="op">&lt;-</span><span class="cn">NULL</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">s</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nsim</span><span class="op">)</span><span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span> 

    <span class="co">## FAB coefficients and variables</span>
    <span class="va">v</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span>
    <span class="kw">if</span><span class="op">(</span><span class="va">scenario</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span><span class="op">{</span> <span class="va">beta</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">p</span><span class="op">)</span> <span class="op">}</span> 
    <span class="kw">if</span><span class="op">(</span><span class="va">scenario</span><span class="op">==</span><span class="fl">2</span><span class="op">)</span><span class="op">{</span> <span class="va">beta</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="op">}</span> 
    <span class="kw">if</span><span class="op">(</span><span class="va">scenario</span><span class="op">==</span><span class="fl">3</span><span class="op">)</span><span class="op">{</span> <span class="va">beta</span><span class="op">&lt;-</span><span class="op">(</span><span class="fl">2</span> <span class="op">-</span> <span class="fl">2</span><span class="op">*</span><span class="va">v</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">3</span> <span class="op">}</span> 
    <span class="va">X</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="va">p</span><span class="op">)</span>,<span class="va">n</span>,<span class="va">p</span><span class="op">)</span><span class="op">/</span><span class="fl">8</span>
 
    <span class="co">## control coefficients and variables  </span>
    <span class="va">alpha1</span><span class="op">&lt;-</span><span class="fl">.5</span> ; <span class="va">alpha2</span><span class="op">&lt;-</span> <span class="op">-</span><span class="fl">.5</span>
    <span class="va">w1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">/</span><span class="fl">8</span>
    <span class="va">w2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">/</span><span class="fl">8</span>

    <span class="co">## simulate data and fit model</span>
    <span class="va">lp</span><span class="op">&lt;-</span><span class="fl">1</span> <span class="op">+</span> <span class="va">alpha1</span><span class="op">*</span><span class="va">w1</span> <span class="op">+</span> <span class="va">alpha2</span><span class="op">*</span><span class="va">w2</span> <span class="op">+</span> <span class="va">X</span><span class="op">%*%</span><span class="va">beta</span> 

    <span class="kw">if</span><span class="op">(</span><span class="va">model</span><span class="op">==</span><span class="st">"Gaussian"</span><span class="op">)</span><span class="op">{</span>
      <span class="va">y</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>,<span class="va">lp</span><span class="op">)</span> 
      <span class="va">fit0</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">w1</span><span class="op">+</span><span class="va">w2</span><span class="op">+</span><span class="va">X</span><span class="op">)</span>
      <span class="va">fit1</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/lmFAB.html">lmFAB</a></span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">w1</span><span class="op">+</span><span class="va">w2</span>,<span class="va">X</span>,<span class="op">~</span><span class="va">v</span>,silent<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
    <span class="op">}</span>

    <span class="kw">if</span><span class="op">(</span><span class="va">model</span><span class="op">==</span><span class="st">"Poisson"</span><span class="op">)</span><span class="op">{</span> 
      <span class="va">y</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span><span class="va">n</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">lp</span><span class="op">)</span><span class="op">)</span>
      <span class="va">fit0</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">w1</span><span class="op">+</span><span class="va">w2</span><span class="op">+</span><span class="va">X</span>,family<span class="op">=</span><span class="va">poisson</span><span class="op">)</span>
      <span class="va">fit1</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/glmFAB.html">glmFAB</a></span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">w1</span><span class="op">+</span><span class="va">w2</span>,<span class="va">X</span>,<span class="op">~</span><span class="va">v</span>,family<span class="op">=</span><span class="va">poisson</span>,silent<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
    <span class="op">}</span>

    <span class="co">## output</span>
    <span class="va">FP</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">FP</span>,<span class="va">fit1</span><span class="op">$</span><span class="va">FABpv</span><span class="op">)</span>
    <span class="va">UP</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">UP</span>,<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit0</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span><span class="op">[</span><span class="va">fit1</span><span class="op">$</span><span class="va">FABvars</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">)</span>  
    <span class="op">}</span>

  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,type<span class="op">=</span><span class="st">"n"</span>,xlab<span class="op">=</span><span class="st">"pval"</span>,ylab<span class="op">=</span><span class="st">""</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,col<span class="op">=</span><span class="st">"gray"</span><span class="op">)</span> 
  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="va">UP</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,length<span class="op">=</span><span class="va">s</span><span class="op">*</span><span class="va">p</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"pink"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="va">FP</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,length<span class="op">=</span><span class="va">s</span><span class="op">*</span><span class="va">p</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="fl">.6</span>,<span class="fl">.4</span>,lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"pink"</span>,<span class="st">"blue"</span><span class="op">)</span>,legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"pU"</span>,<span class="st">"pF"</span><span class="op">)</span><span class="op">)</span> 
 
<span class="op">}</span><span class="op">}</span></code></pre></div>
<p><img src="simstudy_files/figure-html/simstudy-1.png" width="700"></p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Peter Hoff.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
